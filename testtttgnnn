#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  TorPing STEALTH Pro v2.0 - Epic Edition                  â•‘
â•‘  Advanced Anonymous Network Tool                          â•‘
â•‘  Redesigned by: Ninja Code Team                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""

import os
import sys
import time
import subprocess
import json
import requests
from stem import Signal
from stem.control import Controller
from datetime import datetime
import signal

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ¨ COLOR SCHEME - Cyber Hacker Professional
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
class Colors:
    HEADER = '\033[95m'
    OKBLUE = '\033[94m'
    OKCYAN = '\033[96m'
    OKGREEN = '\033[92m'
    WARNING = '\033[93m'
    FAIL = '\033[91m'
    ENDC = '\033[0m'
    BOLD = '\033[1m'
    UNDERLINE = '\033[4m'
    
    # Custom cyber colors
    NEON_GREEN = '\033[38;5;46m'
    NEON_CYAN = '\033[38;5;51m'
    NEON_PINK = '\033[38;5;201m'
    NEON_YELLOW = '\033[38;5;226m'
    DARK_GRAY = '\033[38;5;240m'
    ORANGE = '\033[38;5;208m'

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸŒ GLOBAL CONFIGURATION
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
proxies = {
    "http": "socks5h://127.0.0.1:9050",
    "https": "socks5h://127.0.0.1:9050"
}

# IP History Storage
ip_history = []
rotation_stats = {
    "total_rotations": 0,
    "successful": 0,
    "failed": 0,
    "start_time": None,
    "countries": set()
}

LOG_FILE = f"tor_rotation_history_{datetime.now().strftime('%Y%m%d_%H%M%S')}.txt"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ­ VISUAL EFFECTS & ANIMATIONS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
def print_slow(text, delay=0.03, color=Colors.OKCYAN):
    """Print text with typing effect"""
    for char in text:
        sys.stdout.write(color + char + Colors.ENDC)
        sys.stdout.flush()
        time.sleep(delay)
    print()

def loading_animation(message="Processing", duration=2):
    """Epic loading animation"""
    frames = ["â ‹", "â ™", "â ¹", "â ¸", "â ¼", "â ´", "â ¦", "â §", "â ‡", "â "]
    end_time = time.time() + duration
    
    while time.time() < end_time:
        for frame in frames:
            sys.stdout.write(f'\r{Colors.NEON_CYAN}{frame} {message}...{Colors.ENDC}')
            sys.stdout.flush()
            time.sleep(0.1)
    
    sys.stdout.write('\r' + ' ' * 50 + '\r')
    sys.stdout.flush()

def print_banner():
    """Epic ASCII banner with colors"""
    os.system("clear")
    
    banner = f"""
{Colors.NEON_CYAN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘{Colors.NEON_GREEN}  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  {Colors.NEON_CYAN}â•‘
â•‘{Colors.NEON_GREEN}  â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•  {Colors.NEON_CYAN}â•‘
â•‘{Colors.NEON_GREEN}     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•— {Colors.NEON_CYAN}â•‘
â•‘{Colors.NEON_GREEN}     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘ {Colors.NEON_CYAN}â•‘
â•‘{Colors.NEON_GREEN}     â–ˆâ–ˆâ•‘   â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• {Colors.NEON_CYAN}â•‘
â•‘{Colors.NEON_GREEN}     â•šâ•â•    â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•    â•šâ•â•     â•šâ•â•â•šâ•â•  â•šâ•â•â•â• â•šâ•â•â•â•â•â•  {Colors.NEON_CYAN}â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘{Colors.NEON_PINK}            ğŸ”° STEALTH PRO v2.0 - EPIC EDITION ğŸ”°              {Colors.NEON_CYAN}â•‘
â•‘{Colors.NEON_YELLOW}              Advanced Anonymous Network Tool                  {Colors.NEON_CYAN}â•‘
â•‘{Colors.DARK_GRAY}                   [ Coded with â¤ï¸ by Exprogm ]                 {Colors.NEON_CYAN}â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•{Colors.ENDC}
"""
    print(banner)
    time.sleep(0.5)

def print_separator(char="â•", length=70, color=Colors.NEON_CYAN):
    """Print decorative separator"""
    print(f"{color}{char * length}{Colors.ENDC}")

def print_box(text, color=Colors.OKGREEN):
    """Print text in a box"""
    length = len(text) + 4
    print(f"{color}â•”{'â•' * length}â•—")
    print(f"â•‘  {text}  â•‘")
    print(f"â•š{'â•' * length}â•{Colors.ENDC}")

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ’¾ LOGGING & HISTORY MANAGEMENT
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
def save_to_history(ip_data):
    """Save IP data to history"""
    timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    
    entry = {
        "timestamp": timestamp,
        "ip": ip_data.get("ip"),
        "country": ip_data.get("country"),
        "city": ip_data.get("city"),
        "isp": ip_data.get("isp"),
        "timezone": ip_data.get("timezone", "N/A")
    }
    
    ip_history.append(entry)
    
    # Update stats
    if ip_data.get("country"):
        rotation_stats["countries"].add(ip_data.get("country"))

def export_history():
    """Export history to text file with epic formatting"""
    if not ip_history:
        print(f"{Colors.WARNING}âš ï¸  Tidak ada riwayat untuk disimpan.{Colors.ENDC}")
        return
    
    try:
        with open(LOG_FILE, 'w', encoding='utf-8') as f:
            # Header
            f.write("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n")
            f.write("â•‘          TOR PING STEALTH PRO - IP ROTATION HISTORY              â•‘\n")
            f.write("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n")
            
            # Session Info
            f.write(f"ğŸ“… Session Date: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n")
            f.write(f"ğŸ”¢ Total Rotations: {rotation_stats['total_rotations']}\n")
            f.write(f"âœ… Successful: {rotation_stats['successful']}\n")
            f.write(f"âŒ Failed: {rotation_stats['failed']}\n")
            f.write(f"ğŸŒ Unique Countries: {len(rotation_stats['countries'])}\n")
            f.write(f"ğŸ—ºï¸  Countries Visited: {', '.join(sorted(rotation_stats['countries']))}\n")
            
            if rotation_stats['start_time']:
                duration = time.time() - rotation_stats['start_time']
                f.write(f"â±ï¸  Session Duration: {duration:.2f} seconds\n")
            
            f.write("\n" + "â•" * 70 + "\n")
            f.write("                         IP ROTATION LOG\n")
            f.write("â•" * 70 + "\n\n")
            
            # IP History
            for idx, entry in enumerate(ip_history, 1):
                f.write(f"[{idx:03d}] {entry['timestamp']}\n")
                f.write(f"  â”œâ”€ IP Address : {entry['ip']}\n")
                f.write(f"  â”œâ”€ Location   : {entry['city']}, {entry['country']}\n")
                f.write(f"  â”œâ”€ ISP        : {entry['isp']}\n")
                f.write(f"  â””â”€ Timezone   : {entry['timezone']}\n")
                f.write("\n")
            
            f.write("â•" * 70 + "\n")
            f.write("              End of Report - Stay Anonymous! ğŸ•µï¸\n")
            f.write("â•" * 70 + "\n")
        
        print(f"\n{Colors.OKGREEN}âœ… Riwayat berhasil disimpan ke:{Colors.ENDC} {Colors.BOLD}{LOG_FILE}{Colors.ENDC}")
        print(f"{Colors.NEON_CYAN}ğŸ“Š Total entri: {len(ip_history)}{Colors.ENDC}")
        
    except Exception as e:
        print(f"{Colors.FAIL}âŒ Error saat menyimpan riwayat: {e}{Colors.ENDC}")

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸŒ TOR MANAGEMENT FUNCTIONS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
def is_tor_running():
    """Check if Tor is running"""
    result = subprocess.run(["pgrep", "tor"], stdout=subprocess.PIPE)
    return result.stdout != b''

def start_tor():
    """Start Tor service with epic animation"""
    print_box("ğŸš€ STARTING TOR SERVICE", Colors.NEON_GREEN)
    
    if is_tor_running():
        print(f"{Colors.WARNING}âš¡ Tor sudah aktif dan siap digunakan!{Colors.ENDC}")
    else:
        print(f"{Colors.OKCYAN}ğŸ”„ Initializing Tor network...{Colors.ENDC}")
        os.system("tor > /dev/null 2>&1 &")
        
        loading_animation("Connecting to Tor network", 8)
        
        if is_tor_running():
            print(f"{Colors.OKGREEN}âœ… Tor berhasil dijalankan!{Colors.ENDC}")
            print(f"{Colors.NEON_CYAN}ğŸŒ Status: {Colors.BOLD}ONLINE{Colors.ENDC}")
        else:
            print(f"{Colors.FAIL}âŒ Gagal menjalankan Tor. Pastikan Tor terinstall!{Colors.ENDC}")

def stop_tor():
    """Stop Tor service"""
    print_box("ğŸ›‘ STOPPING TOR SERVICE", Colors.ORANGE)
    
    if is_tor_running():
        loading_animation("Shutting down Tor", 2)
        os.system("pkill tor")
        print(f"{Colors.OKGREEN}âœ… Tor berhasil dimatikan.{Colors.ENDC}")
    else:
        print(f"{Colors.WARNING}â„¹ï¸  Tor sudah tidak aktif.{Colors.ENDC}")

def check_ip_via_tor():
    """Check current IP through Tor with epic display"""
    try:
        print(f"\n{Colors.NEON_CYAN}ğŸ” Checking anonymous IP...{Colors.ENDC}")
        loading_animation("Fetching IP data", 1)
        
        r = requests.get("http://ip-api.com/json", proxies=proxies, timeout=15)
        data = r.json()
        
        ip = data.get("query", "Unknown")
        country = data.get("country", "Unknown")
        city = data.get("city", "Unknown")
        isp = data.get("isp", "Unknown")
        timezone = data.get("timezone", "Unknown")
        
        # Display with epic formatting
        print(f"\n{Colors.BOLD}{Colors.NEON_GREEN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—{Colors.ENDC}")
        print(f"{Colors.BOLD}{Colors.NEON_GREEN}â•‘{Colors.ENDC}  {Colors.NEON_PINK}ğŸŒ CURRENT ANONYMOUS IDENTITY{Colors.ENDC}              {Colors.BOLD}{Colors.NEON_GREEN}â•‘{Colors.ENDC}")
        print(f"{Colors.BOLD}{Colors.NEON_GREEN}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£{Colors.ENDC}")
        print(f"{Colors.BOLD}{Colors.NEON_GREEN}â•‘{Colors.ENDC}  {Colors.NEON_YELLOW}IP Address{Colors.ENDC} : {Colors.BOLD}{ip}{Colors.ENDC}")
        print(f"{Colors.BOLD}{Colors.NEON_GREEN}â•‘{Colors.ENDC}  {Colors.NEON_YELLOW}Location{Colors.ENDC}   : {Colors.BOLD}{city}, {country}{Colors.ENDC}")
        print(f"{Colors.BOLD}{Colors.NEON_GREEN}â•‘{Colors.ENDC}  {Colors.NEON_YELLOW}ISP{Colors.ENDC}        : {Colors.BOLD}{isp}{Colors.ENDC}")
        print(f"{Colors.BOLD}{Colors.NEON_GREEN}â•‘{Colors.ENDC}  {Colors.NEON_YELLOW}Timezone{Colors.ENDC}   : {Colors.BOLD}{timezone}{Colors.ENDC}")
        print(f"{Colors.BOLD}{Colors.NEON_GREEN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•{Colors.ENDC}\n")
        
        # Save to history
        save_to_history({
            "ip": ip,
            "country": country,
            "city": city,
            "isp": isp,
            "timezone": timezone
        })
        
        rotation_stats["successful"] += 1
        
        return True
        
    except requests.exceptions.RequestException as e:
        print(f"{Colors.FAIL}âŒ Network error: Tidak bisa terhubung ke Tor{Colors.ENDC}")
        rotation_stats["failed"] += 1
        return False
    except Exception as e:
        print(f"{Colors.FAIL}âŒ Error: {e}{Colors.ENDC}")
        rotation_stats["failed"] += 1
        return False

def ping_via_tor():
    """Ping website through Tor"""
    print_box("ğŸ“¡ PING THROUGH TOR", Colors.NEON_CYAN)
    
    url = input(f"{Colors.NEON_YELLOW}ğŸŒ Masukkan URL target (tanpa https://): {Colors.ENDC}")
    
    print(f"\n{Colors.OKCYAN}ğŸ“¡ Melakukan ping ke {Colors.BOLD}{url}{Colors.ENDC}{Colors.OKCYAN} melalui Tor...{Colors.ENDC}\n")
    print_separator("â”€", 70, Colors.DARK_GRAY)
    
    os.system(f"proxychains4 ping -c 4 {url}")
    
    print_separator("â”€", 70, Colors.DARK_GRAY)

def rotate_ip(interval):
    """Auto rotate IP with epic real-time display"""
    global rotation_stats
    
    rotation_stats["start_time"] = time.time()
    
    print_box(f"ğŸ”„ AUTO IP ROTATION - Every {interval}s", Colors.NEON_PINK)
    print(f"{Colors.NEON_YELLOW}âš¡ Press Ctrl+C to stop and save history{Colors.ENDC}\n")
    
    try:
        with Controller.from_port(port=9051) as c:
            c.authenticate()
            c.set_options({"MaxCircuitDirtiness": str(interval)})
            
            print(f"{Colors.OKGREEN}âœ… Connected to Tor controller{Colors.ENDC}")
            print_separator()
            
            while True:
                rotation_stats["total_rotations"] += 1
                
                print(f"\n{Colors.NEON_CYAN}{'â•' * 70}{Colors.ENDC}")
                print(f"{Colors.BOLD}{Colors.NEON_PINK}ğŸ”„ ROTATION #{rotation_stats['total_rotations']} - {datetime.now().strftime('%H:%M:%S')}{Colors.ENDC}")
                print(f"{Colors.NEON_CYAN}{'â•' * 70}{Colors.ENDC}")
                
                loading_animation("Rotating IP circuit", 2)
                c.signal(Signal.NEWNYM)
                time.sleep(3)
                
                check_ip_via_tor()
                
                # Display stats
                print(f"{Colors.DARK_GRAY}ğŸ“Š Stats: {rotation_stats['successful']} success | {rotation_stats['failed']} failed | {len(rotation_stats['countries'])} countries{Colors.ENDC}")
                print(f"{Colors.DARK_GRAY}â³ Next rotation in {interval} seconds...{Colors.ENDC}")
                
                time.sleep(interval)
                
    except KeyboardInterrupt:
        print(f"\n\n{Colors.WARNING}{'â•' * 70}{Colors.ENDC}")
        print(f"{Colors.WARNING}â¹ï¸  ROTATION STOPPED BY USER{Colors.ENDC}")
        print(f"{Colors.WARNING}{'â•' * 70}{Colors.ENDC}\n")
        
        # Show summary
        print_box("ğŸ“Š SESSION SUMMARY", Colors.NEON_CYAN)
        print(f"{Colors.NEON_GREEN}âœ… Total Rotations  : {rotation_stats['total_rotations']}{Colors.ENDC}")
        print(f"{Colors.NEON_GREEN}âœ… Successful       : {rotation_stats['successful']}{Colors.ENDC}")
        print(f"{Colors.FAIL}âŒ Failed          : {rotation_stats['failed']}{Colors.ENDC}")
        print(f"{Colors.NEON_YELLOW}ğŸŒ Unique Countries : {len(rotation_stats['countries'])}{Colors.ENDC}")
        
        if rotation_stats['start_time']:
            duration = time.time() - rotation_stats['start_time']
            print(f"{Colors.NEON_CYAN}â±ï¸  Duration        : {duration:.2f} seconds{Colors.ENDC}")
        
        print()
        
        # Auto save history
        loading_animation("Saving rotation history", 2)
        export_history()
        
    except Exception as e:
        print(f"{Colors.FAIL}âŒ Error: {e}{Colors.ENDC}")
        export_history()

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ¯ MENU & MAIN PROGRAM
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
def display_menu():
    """Display epic menu"""
    print(f"\n{Colors.NEON_CYAN}{'â•' * 70}{Colors.ENDC}")
    print(f"{Colors.BOLD}{Colors.NEON_PINK}                    ğŸ¯ MAIN MENU ğŸ¯{Colors.ENDC}")
    print(f"{Colors.NEON_CYAN}{'â•' * 70}{Colors.ENDC}")
    
    menu_items = [
        ("1", "ğŸš€ Start Tor Service", Colors.NEON_GREEN),
        ("2", "ğŸ” Check Anonymous IP", Colors.NEON_CYAN),
        ("3", "ğŸ“¡ Ping via Tor", Colors.NEON_YELLOW),
        ("4", "ğŸ”„ Auto Rotate IP", Colors.NEON_PINK),
        ("5", "ğŸ“Š View History Stats", Colors.ORANGE),
        ("6", "ğŸ’¾ Export History Now", Colors.OKBLUE),
        ("7", "ğŸ›‘ Stop Tor Service", Colors.WARNING),
        ("0", "ğŸšª Exit Program", Colors.FAIL)
    ]
    
    for key, text, color in menu_items:
        print(f"{color}  [{key}]{Colors.ENDC} {text}")
    
    print(f"{Colors.NEON_CYAN}{'â•' * 70}{Colors.ENDC}")

def show_stats():
    """Show current session statistics"""
    print_box("ğŸ“Š SESSION STATISTICS", Colors.NEON_CYAN)
    
    print(f"{Colors.NEON_GREEN}ğŸ”¢ Total IP Checks  : {len(ip_history)}{Colors.ENDC}")
    print(f"{Colors.NEON_GREEN}âœ… Successful       : {rotation_stats['successful']}{Colors.ENDC}")
    print(f"{Colors.FAIL}âŒ Failed          : {rotation_stats['failed']}{Colors.ENDC}")
    print(f"{Colors.NEON_YELLOW}ğŸŒ Unique Countries : {len(rotation_stats['countries'])}{Colors.ENDC}")
    
    if rotation_stats['countries']:
        print(f"{Colors.NEON_CYAN}ğŸ—ºï¸  Countries: {', '.join(sorted(rotation_stats['countries']))}{Colors.ENDC}")
    
    if ip_history:
        print(f"\n{Colors.DARK_GRAY}Last IP: {ip_history[-1]['ip']} ({ip_history[-1]['country']}){Colors.ENDC}")

def graceful_exit(signum=None, frame=None):
    """Handle graceful exit on Ctrl+C"""
    print(f"\n\n{Colors.WARNING}{'â•' * 70}{Colors.ENDC}")
    print(f"{Colors.WARNING}ğŸ›‘ Program interrupted by user{Colors.ENDC}")
    print(f"{Colors.WARNING}{'â•' * 70}{Colors.ENDC}\n")
    
    if ip_history:
        export_history()
    
    print(f"\n{Colors.NEON_PINK}ğŸ‘‹ Thanks for using TorPing STEALTH Pro!{Colors.ENDC}")
    print(f"{Colors.NEON_CYAN}ğŸ•µï¸  Stay anonymous, stay safe bre!{Colors.ENDC}\n")
    
    sys.exit(0)

# Register signal handler
signal.signal(signal.SIGINT, graceful_exit)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸš€ MAIN PROGRAM LOOP
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
def main():
    """Main program loop"""
    print_banner()
    print_slow("âš¡ Initializing TorPing STEALTH Pro v2.0...", 0.02, Colors.NEON_CYAN)
    time.sleep(0.5)
    
    while True:
        try:
            display_menu()
            pilihan = input(f"\n{Colors.BOLD}{Colors.NEON_YELLOW}ğŸ¯ Pilih menu [0-7]: {Colors.ENDC}")
            
            print()  # Newline for better spacing
            
            if pilihan == "1":
                start_tor()
                
            elif pilihan == "2":
                check_ip_via_tor()
                
            elif pilihan == "3":
                ping_via_tor()
                
            elif pilihan == "4":
                print(f"{Colors.NEON_PINK}{'â•' * 70}{Colors.ENDC}")
                print(f"{Colors.BOLD}âš™ï¸  SELECT ROTATION INTERVAL{Colors.ENDC}")
                print(f"{Colors.NEON_PINK}{'â•' * 70}{Colors.ENDC}")
                print(f"{Colors.NEON_GREEN}  [1]{Colors.ENDC} âš¡ Fast Mode    - 3 seconds")
                print(f"{Colors.NEON_YELLOW}  [2]{Colors.ENDC} ğŸ”„ Normal Mode  - 10 seconds")
                print(f"{Colors.NEON_CYAN}  [3]{Colors.ENDC} ğŸ¢ Slow Mode    - 300 seconds (5 min)")
                print(f"{Colors.FAIL}  [0]{Colors.ENDC} âŒ Cancel")
                print(f"{Colors.NEON_PINK}{'â•' * 70}{Colors.ENDC}")
                
                pilih_interval = input(f"{Colors.NEON_YELLOW}âš¡ Select [0-3]: {Colors.ENDC}")
                
                if pilih_interval == "1":
                    rotate_ip(3)
                elif pilih_interval == "2":
                    rotate_ip(10)
                elif pilih_interval == "3":
                    rotate_ip(300)
                else:
                    print(f"{Colors.WARNING}â¡ï¸  Rotation cancelled.{Colors.ENDC}")
                    
            elif pilihan == "5":
                show_stats()
                
            elif pilihan == "6":
                export_history()
                
            elif pilihan == "7":
                stop_tor()
                
            elif pilihan == "0":
                print_box("ğŸ‘‹ EXITING PROGRAM", Colors.NEON_PINK)
                
                if ip_history:
                    save_choice = input(f"{Colors.NEON_YELLOW}ğŸ’¾ Save history before exit? (y/n): {Colors.ENDC}").lower()
                    if save_choice == 'y':
                        export_history()
                
                print(f"\n{Colors.NEON_CYAN}ğŸ•µï¸  Stay anonymous, stay safe bre!{Colors.ENDC}")
                print(f"{Colors.NEON_GREEN}âœ¨ Sampai jumpa lagi!{Colors.ENDC}\n")
                break
                
            else:
                print(f"{Colors.FAIL}âš ï¸  Pilihan tidak valid! Coba lagi.{Colors.ENDC}")
            
            # Pause before showing menu again
            input(f"\n{Colors.DARK_GRAY}Press Enter to continue...{Colors.ENDC}")
            os.system("clear")
            print_banner()
            
        except KeyboardInterrupt:
            graceful_exit()
        except Exception as e:
            print(f"{Colors.FAIL}âŒ Unexpected error: {e}{Colors.ENDC}")
            time.sleep(2)

if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        graceful_exit()
    except Exception as e:
        print(f"{Colors.FAIL}âŒ Fatal error: {e}{Colors.ENDC}")
        sys.exit(1)
