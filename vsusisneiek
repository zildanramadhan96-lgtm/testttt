#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘        W E B   S E C U R I T Y   S C A N N E R   v3.0            â•‘
â•‘              EPIC PROFESSIONAL HACKER EDITION                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""

import requests
import os
import time
import sys
import socket
import ssl
import concurrent.futures
from datetime import datetime
from urllib.parse import urlparse
import json

# ANSI Color Codes
class Colors:
    RED = '\033[91m'
    GREEN = '\033[92m'
    YELLOW = '\033[93m'
    BLUE = '\033[94m'
    MAGENTA = '\033[95m'
    CYAN = '\033[96m'
    WHITE = '\033[97m'
    BOLD = '\033[1m'
    DIM = '\033[2m'
    RESET = '\033[0m'
    BLINK = '\033[5m'

def clear_screen():
    """Clear terminal screen"""
    os.system('cls' if os.name == 'nt' else 'clear')

def print_banner():
    """Print epic hacker banner"""
    banner = f"""
{Colors.CYAN}{Colors.BOLD}
    â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—
    â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘
    â–ˆâ–ˆâ•‘ â–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘
    â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—    â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘
    â•šâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘
     â•šâ•â•â•â•šâ•â•â• â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•     â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•â•
{Colors.MAGENTA}
         â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
         â•‘    S E C U R I T Y   S C A N N E R   v3.0      â•‘
         â•‘         EPIC PROFESSIONAL EDITION               â•‘
         â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{Colors.YELLOW}
      ğŸ›¡ï¸  Advanced Web Security Analysis & Vulnerability Scanner
{Colors.DIM}                ~ Upgraded by danz411 ~{Colors.RESET}
"""
    print(banner)

def loading_animation(text, duration=1.5):
    """Animasi loading hacker style"""
    frames = ['â ‹', 'â ™', 'â ¹', 'â ¸', 'â ¼', 'â ´', 'â ¦', 'â §', 'â ‡', 'â ']
    end_time = time.time() + duration
    i = 0
    while time.time() < end_time:
        frame = frames[i % len(frames)]
        sys.stdout.write(f'\r{Colors.CYAN}{frame}{Colors.RESET} {text}')
        sys.stdout.flush()
        time.sleep(0.1)
        i += 1
    sys.stdout.write('\r' + ' ' * (len(text) + 5) + '\r')
    sys.stdout.flush()

def validate_url(url):
    """Validate and normalize URL"""
    if not url.startswith(('http://', 'https://')):
        url = 'https://' + url
    return url

def get_server_info(url):
    """Get basic server information"""
    try:
        parsed = urlparse(url)
        host = parsed.netloc or parsed.path
        
        # Get IP address
        ip_address = socket.gethostbyname(host)
        
        # Get DNS info
        try:
            dns_info = socket.getaddrinfo(host, None)
            ipv6 = [info[4][0] for info in dns_info if info[0] == socket.AF_INET6]
        except:
            ipv6 = []
        
        return {
            'host': host,
            'ip': ip_address,
            'ipv6': ipv6[0] if ipv6 else 'N/A'
        }
    except Exception as e:
        return {'error': str(e)}

def check_ssl_certificate(url):
    """Check SSL certificate details"""
    try:
        parsed = urlparse(url)
        hostname = parsed.netloc or parsed.path
        port = 443
        
        context = ssl.create_default_context()
        with socket.create_connection((hostname, port), timeout=10) as sock:
            with context.wrap_socket(sock, server_hostname=hostname) as ssock:
                cert = ssock.getpeercert()
                
                return {
                    'valid': True,
                    'issuer': dict(x[0] for x in cert['issuer']),
                    'subject': dict(x[0] for x in cert['subject']),
                    'version': cert['version'],
                    'not_before': cert['notBefore'],
                    'not_after': cert['notAfter'],
                    'serial_number': cert['serialNumber']
                }
    except Exception as e:
        return {'valid': False, 'error': str(e)}

def cek_keamanan_advanced(url):
    """Advanced security headers check"""
    try:
        response = requests.get(url, timeout=10, allow_redirects=True)
        headers = response.headers
        
        # Security headers to check
        security_headers = {
            'Server': {'found': False, 'value': None, 'risk': 'LOW', 'info': 'Server information disclosure'},
            'X-Powered-By': {'found': False, 'value': None, 'risk': 'MEDIUM', 'info': 'Technology stack disclosure'},
            'X-Frame-Options': {'found': False, 'value': None, 'risk': 'HIGH', 'info': 'Clickjacking protection'},
            'X-Content-Type-Options': {'found': False, 'value': None, 'risk': 'MEDIUM', 'info': 'MIME-sniffing protection'},
            'Content-Security-Policy': {'found': False, 'value': None, 'risk': 'HIGH', 'info': 'XSS and injection protection'},
            'X-XSS-Protection': {'found': False, 'value': None, 'risk': 'MEDIUM', 'info': 'XSS filter'},
            'Strict-Transport-Security': {'found': False, 'value': None, 'risk': 'HIGH', 'info': 'HTTPS enforcement'},
            'Referrer-Policy': {'found': False, 'value': None, 'risk': 'LOW', 'info': 'Referrer information control'},
            'Permissions-Policy': {'found': False, 'value': None, 'risk': 'MEDIUM', 'info': 'Feature policy'},
            'X-DNS-Prefetch-Control': {'found': False, 'value': None, 'risk': 'LOW', 'info': 'DNS prefetch control'},
            'Expect-CT': {'found': False, 'value': None, 'risk': 'MEDIUM', 'info': 'Certificate transparency'},
            'Access-Control-Allow-Origin': {'found': False, 'value': None, 'risk': 'MEDIUM', 'info': 'CORS policy'},
            'Set-Cookie': {'found': False, 'value': None, 'risk': 'MEDIUM', 'info': 'Cookie security flags'},
            'Cache-Control': {'found': False, 'value': None, 'risk': 'LOW', 'info': 'Cache policy'},
            'Pragma': {'found': False, 'value': None, 'risk': 'LOW', 'info': 'HTTP/1.0 cache control'}
        }
        
        # Check each header
        for header_name in security_headers:
            if header_name in headers:
                security_headers[header_name]['found'] = True
                security_headers[header_name]['value'] = headers[header_name]
        
        # Additional checks
        result = {
            'status_code': response.status_code,
            'headers': security_headers,
            'https': url.startswith('https://'),
            'redirects': len(response.history),
            'response_time': response.elapsed.total_seconds(),
            'content_type': headers.get('Content-Type', 'Unknown'),
            'server_type': headers.get('Server', 'Unknown')
        }
        
        return result
    
    except Exception as e:
        return {'error': str(e)}

def calculate_security_score(security_data):
    """Calculate security score based on headers"""
    if 'error' in security_data:
        return 0
    
    score = 100
    critical_headers = ['Strict-Transport-Security', 'Content-Security-Policy', 'X-Frame-Options']
    important_headers = ['X-Content-Type-Options', 'X-XSS-Protection', 'Referrer-Policy']
    
    headers = security_data['headers']
    
    # Deduct points for missing critical headers
    for header in critical_headers:
        if not headers[header]['found']:
            score -= 15
    
    # Deduct points for missing important headers
    for header in important_headers:
        if not headers[header]['found']:
            score -= 10
    
    # Deduct if not HTTPS
    if not security_data['https']:
        score -= 20
    
    # Bonus for having Server/X-Powered-By hidden
    if not headers['Server']['found']:
        score += 5
    if not headers['X-Powered-By']['found']:
        score += 5
    
    return max(0, min(100, score))

def stress_testing_advanced(url, num_requests=1000, workers=100):
    """Advanced stress testing with detailed metrics"""
    try:
        results = {
            'success': 0,
            'failed': 0,
            'status_codes': {},
            'response_times': [],
            'errors': {},
            'start_time': time.time()
        }
        
        def send_request(url):
            try:
                start = time.time()
                response = requests.get(url, timeout=10)
                elapsed = time.time() - start
                
                return {
                    'success': True,
                    'status_code': response.status_code,
                    'response_time': elapsed
                }
            except Exception as e:
                return {
                    'success': False,
                    'error': type(e).__name__
                }
        
        print(f"\n{Colors.YELLOW}ğŸ“Š Starting stress test with {num_requests} requests...{Colors.RESET}\n")
        
        with concurrent.futures.ThreadPoolExecutor(max_workers=workers) as executor:
            futures = [executor.submit(send_request, url) for _ in range(num_requests)]
            
            completed = 0
            for future in concurrent.futures.as_completed(futures):
                result = future.result()
                completed += 1
                
                if result['success']:
                    results['success'] += 1
                    status = result['status_code']
                    if status not in results['status_codes']:
                        results['status_codes'][status] = 0
                    results['status_codes'][status] += 1
                    results['response_times'].append(result['response_time'])
                else:
                    results['failed'] += 1
                    error = result['error']
                    if error not in results['errors']:
                        results['errors'][error] = 0
                    results['errors'][error] += 1
                
                # Progress indicator
                if completed % 100 == 0:
                    progress = (completed / num_requests) * 100
                    print(f"{Colors.CYAN}Progress: {progress:.1f}% | Success: {Colors.GREEN}{results['success']}{Colors.RESET} | Failed: {Colors.RED}{results['failed']}{Colors.RESET}", end='\r')
        
        results['total_time'] = time.time() - results['start_time']
        results['requests_per_second'] = num_requests / results['total_time'] if results['total_time'] > 0 else 0
        
        if results['response_times']:
            results['avg_response_time'] = sum(results['response_times']) / len(results['response_times'])
            results['min_response_time'] = min(results['response_times'])
            results['max_response_time'] = max(results['response_times'])
        
        print()  # New line after progress
        return results
    
    except Exception as e:
        return {'error': str(e)}

def check_server_alive(url):
    """Check if server is still responding"""
    try:
        response = requests.get(url, timeout=5)
        return response.status_code < 500
    except:
        return False

def display_security_report(url, security_data, server_info, ssl_info):
    """Display comprehensive security report"""
    clear_screen()
    print_banner()
    
    W = 74
    
    print(f"\n{Colors.CYAN}{Colors.BOLD}{'='*W}")
    print(f"{'ğŸ›¡ï¸  LAPORAN KEAMANAN WEB':^{W}}")
    print(f"{'='*W}{Colors.RESET}")
    
    # SERVER INFO
    print(f"\n{Colors.CYAN}+{'-'*72}+")
    print(f"| {Colors.YELLOW}{Colors.BOLD}INFORMASI SERVER{Colors.RESET}{' '*54}{Colors.CYAN} |")
    print(f"+{'-'*72}+{Colors.RESET}")
    
    if 'error' not in server_info:
        print(f"{Colors.CYAN}|{Colors.RESET} Target URL        : {Colors.WHITE}{url[:51]:<51}{Colors.CYAN}|{Colors.RESET}")
        print(f"{Colors.CYAN}|{Colors.RESET} Hostname          : {Colors.WHITE}{server_info['host'][:51]:<51}{Colors.CYAN}|{Colors.RESET}")
        print(f"{Colors.CYAN}|{Colors.RESET} IP Address (IPv4) : {Colors.WHITE}{server_info['ip']:<51}{Colors.CYAN}|{Colors.RESET}")
        print(f"{Colors.CYAN}|{Colors.RESET} IP Address (IPv6) : {Colors.WHITE}{str(server_info['ipv6'])[:51]:<51}{Colors.CYAN}|{Colors.RESET}")
    
    if 'error' not in security_data:
        print(f"{Colors.CYAN}|{Colors.RESET} Server Type       : {Colors.WHITE}{security_data['server_type'][:51]:<51}{Colors.CYAN}|{Colors.RESET}")
        print(f"{Colors.CYAN}|{Colors.RESET} Status Code       : {Colors.GREEN if security_data['status_code'] == 200 else Colors.YELLOW}{security_data['status_code']}{Colors.RESET}{' ' * (51 - len(str(security_data['status_code'])))}{Colors.CYAN}|{Colors.RESET}")
        print(f"{Colors.CYAN}|{Colors.RESET} Response Time     : {Colors.YELLOW}{security_data['response_time']:.3f}s{Colors.RESET}{' ' * (51 - len(f"{security_data['response_time']:.3f}s") - 1)}{Colors.CYAN}|{Colors.RESET}")
        print(f"{Colors.CYAN}|{Colors.RESET} HTTPS Enabled     : {Colors.GREEN + 'âœ“ Yes' + Colors.RESET if security_data['https'] else Colors.RED + 'âœ— No' + Colors.RESET}{' ' * (51 - 5)}{Colors.CYAN}|{Colors.RESET}")
    
    print(f"{Colors.CYAN}+{'-'*72}+{Colors.RESET}")
    
    # SSL CERTIFICATE
    if ssl_info['valid']:
        print(f"\n{Colors.CYAN}+{'-'*72}+")
        print(f"| {Colors.YELLOW}{Colors.BOLD}SERTIFIKAT SSL/TLS{Colors.RESET}{' '*52}{Colors.CYAN} |")
        print(f"+{'-'*72}+{Colors.RESET}")
        
        issuer_org = ssl_info['issuer'].get('organizationName', 'Unknown')[:40]
        subject_cn = ssl_info['subject'].get('commonName', 'Unknown')[:40]
        
        print(f"{Colors.CYAN}|{Colors.RESET} Status            : {Colors.GREEN}âœ“ Valid{Colors.RESET}{' ' * (51 - 7)}{Colors.CYAN}|{Colors.RESET}")
        print(f"{Colors.CYAN}|{Colors.RESET} Issuer            : {Colors.WHITE}{issuer_org:<51}{Colors.CYAN}|{Colors.RESET}")
        print(f"{Colors.CYAN}|{Colors.RESET} Subject           : {Colors.WHITE}{subject_cn:<51}{Colors.CYAN}|{Colors.RESET}")
        print(f"{Colors.CYAN}|{Colors.RESET} Valid From        : {Colors.WHITE}{ssl_info['not_before'][:51]:<51}{Colors.CYAN}|{Colors.RESET}")
        print(f"{Colors.CYAN}|{Colors.RESET} Valid Until       : {Colors.WHITE}{ssl_info['not_after'][:51]:<51}{Colors.CYAN}|{Colors.RESET}")
        print(f"{Colors.CYAN}+{'-'*72}+{Colors.RESET}")
    
    # SECURITY SCORE
    if 'error' not in security_data:
        score = calculate_security_score(security_data)
        
        if score >= 80:
            score_color = Colors.GREEN
            rating = "EXCELLENT"
        elif score >= 60:
            score_color = Colors.YELLOW
            rating = "GOOD"
        elif score >= 40:
            score_color = Colors.YELLOW
            rating = "FAIR"
        else:
            score_color = Colors.RED
            rating = "POOR"
        
        print(f"\n{Colors.CYAN}+{'-'*72}+")
        print(f"| {Colors.YELLOW}{Colors.BOLD}SKOR KEAMANAN{Colors.RESET}{' '*57}{Colors.CYAN} |")
        print(f"+{'-'*72}+{Colors.RESET}")
        print(f"{Colors.CYAN}|{Colors.RESET} Security Score    : {score_color}{Colors.BOLD}{score}/100 [{rating}]{Colors.RESET}{' ' * (51 - len(f"{score}/100 [{rating}]") - 1)}{Colors.CYAN}|{Colors.RESET}")
        print(f"{Colors.CYAN}+{'-'*72}+{Colors.RESET}")
    
    # SECURITY HEADERS
    if 'error' not in security_data:
        print(f"\n{Colors.CYAN}+{'-'*72}+")
        print(f"| {Colors.YELLOW}{Colors.BOLD}ANALISIS HEADER KEAMANAN{Colors.RESET}{' '*46}{Colors.CYAN} |")
        print(f"+{'-'*30}+{'-'*11}+{'-'*30}+")
        print(f"| {Colors.BOLD}{'Header':<28}{Colors.RESET} {Colors.CYAN}|{Colors.RESET} {Colors.BOLD}{'Status':^9}{Colors.RESET} {Colors.CYAN}|{Colors.RESET} {Colors.BOLD}{'Risk Level':<28}{Colors.RESET} {Colors.CYAN}|{Colors.RESET}")
        print(f"{Colors.CYAN}+{'-'*30}+{'-'*11}+{'-'*30}+{Colors.RESET}")
        
        for header_name, header_data in security_data['headers'].items():
            status = f"{Colors.GREEN}âœ“ Found{Colors.RESET}" if header_data['found'] else f"{Colors.RED}âœ— Missing{Colors.RESET}"
            
            # Risk color
            if header_data['risk'] == 'HIGH':
                risk_color = Colors.RED
            elif header_data['risk'] == 'MEDIUM':
                risk_color = Colors.YELLOW
            else:
                risk_color = Colors.GREEN
            
            risk_display = f"{risk_color}{header_data['risk']}{Colors.RESET}"
            
            # Truncate header name if too long
            header_display = header_name[:28]
            
            print(f"{Colors.CYAN}|{Colors.RESET} {header_display:<28} {Colors.CYAN}|{Colors.RESET} {status} {Colors.CYAN}|{Colors.RESET} {risk_display}{' ' * (28 - len(header_data['risk']))}{Colors.CYAN}|{Colors.RESET}")
        
        print(f"{Colors.CYAN}+{'-'*30}+{'-'*11}+{'-'*30}+{Colors.RESET}")
    
    print(f"\n{Colors.CYAN}{Colors.BOLD}{'='*W}{Colors.RESET}\n")

def display_stress_test_report(url, results):
    """Display stress test results"""
    clear_screen()
    print_banner()
    
    W = 74
    
    print(f"\n{Colors.CYAN}{Colors.BOLD}{'='*W}")
    print(f"{'âš¡ LAPORAN STRESS TEST':^{W}}")
    print(f"{'='*W}{Colors.RESET}")
    
    if 'error' in results:
        print(f"\n{Colors.RED}âŒ Error: {results['error']}{Colors.RESET}\n")
        return
    
    # Check if server is still alive
    server_alive = check_server_alive(url)
    server_status = f"{Colors.GREEN}âœ“ AKTIF{Colors.RESET}" if server_alive else f"{Colors.RED}âœ— DOWN{Colors.RESET}"
    
    # RINGKASAN
    print(f"\n{Colors.CYAN}+{'-'*72}+")
    print(f"| {Colors.YELLOW}{Colors.BOLD}RINGKASAN{Colors.RESET}{' '*61}{Colors.CYAN} |")
    print(f"+{'-'*72}+{Colors.RESET}")
    
    print(f"{Colors.CYAN}|{Colors.RESET} Target URL        : {Colors.WHITE}{url[:51]:<51}{Colors.CYAN}|{Colors.RESET}")
    print(f"{Colors.CYAN}|{Colors.RESET} Status Server     : {server_status}{' ' * (51 - 7)}{Colors.CYAN}|{Colors.RESET}")
    print(f"{Colors.CYAN}|{Colors.RESET} Total Waktu       : {Colors.YELLOW}{results['total_time']:.2f}s{Colors.RESET}{' ' * (51 - len(f"{results['total_time']:.2f}s") - 1)}{Colors.CYAN}|{Colors.RESET}")
    print(f"{Colors.CYAN}+{'-'*72}+{Colors.RESET}")
    
    # STATISTIK REQUEST
    print(f"\n{Colors.CYAN}+{'-'*72}+")
    print(f"| {Colors.YELLOW}{Colors.BOLD}{'STATISTIK REQUEST':^70}{Colors.RESET} {Colors.CYAN}|")
    print(f"+{'-'*35}+{'-'*36}+")
    print(f"| {Colors.BOLD}{'Metric':<33}{Colors.RESET} {Colors.CYAN}|{Colors.RESET} {Colors.BOLD}{'Value':>34}{Colors.RESET} {Colors.CYAN}|{Colors.RESET}")
    print(f"{Colors.CYAN}+{'-'*35}+{'-'*36}+{Colors.RESET}")
    
    total_requests = results['success'] + results['failed']
    success_rate = (results['success'] / total_requests * 100) if total_requests > 0 else 0
    
    print(f"{Colors.CYAN}|{Colors.RESET} Total Request                   {Colors.CYAN}|{Colors.RESET} {Colors.WHITE}{total_requests:>34}{Colors.RESET} {Colors.CYAN}|{Colors.RESET}")
    print(f"{Colors.CYAN}|{Colors.RESET} {Colors.GREEN}âœ… Berhasil{Colors.RESET}                      {Colors.CYAN}|{Colors.RESET} {Colors.GREEN}{results['success']:>12}{Colors.RESET} ({Colors.GREEN}{success_rate:>6.1f}%{Colors.RESET}) {Colors.CYAN}|{Colors.RESET}")
    print(f"{Colors.CYAN}|{Colors.RESET} {Colors.RED}âŒ Gagal{Colors.RESET}                         {Colors.CYAN}|{Colors.RESET} {Colors.RED}{results['failed']:>12}{Colors.RESET} ({Colors.RED}{100-success_rate:>6.1f}%{Colors.RESET}) {Colors.CYAN}|{Colors.RESET}")
    print(f"{Colors.CYAN}|{Colors.RESET} Request Per Second (RPS)        {Colors.CYAN}|{Colors.RESET} {Colors.MAGENTA}{results['requests_per_second']:>18.2f} req/s{Colors.RESET} {Colors.CYAN}|{Colors.RESET}")
    
    if 'avg_response_time' in results:
        print(f"{Colors.CYAN}|{Colors.RESET} Avg Response Time               {Colors.CYAN}|{Colors.RESET} {Colors.YELLOW}{results['avg_response_time']:>18.3f} sec{Colors.RESET} {Colors.CYAN}|{Colors.RESET}")
        print(f"{Colors.CYAN}|{Colors.RESET} Min Response Time               {Colors.CYAN}|{Colors.RESET} {Colors.GREEN}{results['min_response_time']:>18.3f} sec{Colors.RESET} {Colors.CYAN}|{Colors.RESET}")
        print(f"{Colors.CYAN}|{Colors.RESET} Max Response Time               {Colors.CYAN}|{Colors.RESET} {Colors.RED}{results['max_response_time']:>18.3f} sec{Colors.RESET} {Colors.CYAN}|{Colors.RESET}")
    
    print(f"{Colors.CYAN}+{'-'*35}+{'-'*36}+{Colors.RESET}")
    
    # STATUS CODE BREAKDOWN
    if results['status_codes']:
        print(f"\n{Colors.CYAN}+{'-'*72}+")
        print(f"| {Colors.YELLOW}{Colors.BOLD}{'STATUS CODE BREAKDOWN':^70}{Colors.RESET} {Colors.CYAN}|")
        print(f"+{'-'*35}+{'-'*18}+{'-'*17}+")
        print(f"| {Colors.BOLD}{'Status Code':<33}{Colors.RESET} {Colors.CYAN}|{Colors.RESET} {Colors.BOLD}{'Count':>16}{Colors.RESET} {Colors.CYAN}|{Colors.RESET} {Colors.BOLD}{'Percentage':>15}{Colors.RESET} {Colors.CYAN}|{Colors.RESET}")
        print(f"{Colors.CYAN}+{'-'*35}+{'-'*18}+{'-'*17}+{Colors.RESET}")
        
        sorted_codes = sorted(results['status_codes'].items(), key=lambda x: x[1], reverse=True)
        for code, count in sorted_codes:
            percentage = (count / results['success'] * 100) if results['success'] > 0 else 0
            
            if code == 200:
                code_color = Colors.GREEN
                emoji = "âœ…"
            elif 200 <= code < 300:
                code_color = Colors.GREEN
                emoji = "âœ¨"
            elif 300 <= code < 400:
                code_color = Colors.BLUE
                emoji = "ğŸ”„"
            elif 400 <= code < 500:
                code_color = Colors.YELLOW
                emoji = "âš ï¸"
            else:
                code_color = Colors.RED
                emoji = "ğŸ”¥"
            
            code_str = f"{emoji} {code_color}{code}{Colors.RESET}"
            print(f"{Colors.CYAN}|{Colors.RESET} {code_str:<33} {Colors.CYAN}|{Colors.RESET} {Colors.WHITE}{count:>16}{Colors.RESET} {Colors.CYAN}|{Colors.RESET} {Colors.YELLOW}{percentage:>14.1f}%{Colors.RESET} {Colors.CYAN}|{Colors.RESET}")
        
        print(f"{Colors.CYAN}+{'-'*35}+{'-'*18}+{'-'*17}+{Colors.RESET}")
    
    # ERROR BREAKDOWN
    if results['errors']:
        print(f"\n{Colors.CYAN}+{'-'*72}+")
        print(f"| {Colors.YELLOW}{Colors.BOLD}{'ERROR BREAKDOWN':^70}{Colors.RESET} {Colors.CYAN}|")
        print(f"+{'-'*35}+{'-'*18}+{'-'*17}+")
        print(f"| {Colors.BOLD}{'Error Type':<33}{Colors.RESET} {Colors.CYAN}|{Colors.RESET} {Colors.BOLD}{'Count':>16}{Colors.RESET} {Colors.CYAN}|{Colors.RESET} {Colors.BOLD}{'Percentage':>15}{Colors.RESET} {Colors.CYAN}|{Colors.RESET}")
        print(f"{Colors.CYAN}+{'-'*35}+{'-'*18}+{'-'*17}+{Colors.RESET}")
        
        sorted_errors = sorted(results['errors'].items(), key=lambda x: x[1], reverse=True)
        for error_type, count in sorted_errors:
            percentage = (count / results['failed'] * 100) if results['failed'] > 0 else 0
            error_display = error_type[:32]
            print(f"{Colors.CYAN}|{Colors.RESET} {Colors.RED}{error_display:<33}{Colors.RESET} {Colors.CYAN}|{Colors.RESET} {Colors.WHITE}{count:>16}{Colors.RESET} {Colors.CYAN}|{Colors.RESET} {Colors.YELLOW}{percentage:>14.1f}%{Colors.RESET} {Colors.CYAN}|{Colors.RESET}")
        
        print(f"{Colors.CYAN}+{'-'*35}+{'-'*18}+{'-'*17}+{Colors.RESET}")
    
    # Kesimpulan
    if server_alive:
        if success_rate >= 95:
            print(f"\n{Colors.GREEN}âœ… Server SANGAT KUAT! Mampu menangani stress test dengan baik.{Colors.RESET}")
        elif success_rate >= 80:
            print(f"\n{Colors.YELLOW}âš ï¸  Server CUKUP KUAT, namun ada beberapa request yang gagal.{Colors.RESET}")
        else:
            print(f"\n{Colors.YELLOW}âš ï¸  Server LEMAH! Banyak request yang gagal, pertimbangkan upgrade.{Colors.RESET}")
    else:
        print(f"\n{Colors.RED}ğŸ¯ Server DOWN! Stress test berhasil menjatuhkan target!{Colors.RESET}")
    
    print(f"\n{Colors.CYAN}{Colors.BOLD}{'='*W}{Colors.RESET}\n")

def main():
    """Main program loop"""
    while True:
        clear_screen()
        print_banner()
        
        print(f"{Colors.CYAN}{'â•' * 74}{Colors.RESET}\n")
        print(f"{Colors.YELLOW}{Colors.BOLD}                        MENU UTAMA{Colors.RESET}\n")
        print(f"{Colors.GREEN}  [1]{Colors.RESET} ğŸ›¡ï¸  Cek Keamanan Web (Security Headers)")
        print(f"{Colors.GREEN}  [2]{Colors.RESET} âš¡ Stress Test Server (Vulnerability Test)")
        print(f"{Colors.GREEN}  [3]{Colors.RESET} ğŸšª Keluar\n")
        print(f"{Colors.CYAN}{'â•' * 74}{Colors.RESET}")
        
        pilihan = input(f"\n{Colors.YELLOW}ğŸ’€ Pilih menu{Colors.RESET} [{Colors.CYAN}1-3{Colors.RESET}]: ").strip()
        
        if pilihan == "1":
            print(f"\n{Colors.CYAN}{'â”€' * 74}{Colors.RESET}")
            url = input(f"{Colors.YELLOW}ğŸ¯ Masukkan URL target{Colors.RESET}: ").strip()
            
            if not url:
                print(f"{Colors.RED}âŒ URL tidak boleh kosong!{Colors.RESET}")
                time.sleep(2)
                continue
            
            url = validate_url(url)
            
            print(f"\n{Colors.CYAN}{'â”€' * 74}{Colors.RESET}\n")
            
            # Scanning process
            loading_animation("ğŸ” Resolving domain...", 1)
            server_info = get_server_info(url)
            print(f"{Colors.GREEN}âœ“{Colors.RESET} Domain resolved")
            
            loading_animation("ğŸ” Checking SSL certificate...", 1.5)
            ssl_info = check_ssl_certificate(url)
            if ssl_info['valid']:
                print(f"{Colors.GREEN}âœ“{Colors.RESET} SSL certificate validated")
            else:
                print(f"{Colors.YELLOW}âš {Colors.RESET}  SSL check failed or not available")
            
            loading_animation("ğŸ›¡ï¸  Analyzing security headers...", 2)
            security_data = cek_keamanan_advanced(url)
            print(f"{Colors.GREEN}âœ“{Colors.RESET} Security analysis complete")
            
            loading_animation("ğŸ“Š Generating report...", 1.5)
            
            # Display report
            display_security_report(url, security_data, server_info, ssl_info)
            
            input(f"{Colors.YELLOW}Tekan Enter untuk kembali ke menu...{Colors.RESET}")
        
        elif pilihan == "2":
            print(f"\n{Colors.CYAN}{'â”€' * 74}{Colors.RESET}")
            url = input(f"{Colors.YELLOW}ğŸ¯ Masukkan URL target{Colors.RESET}: ").strip()
            
            if not url:
                print(f"{Colors.RED}âŒ URL tidak boleh kosong!{Colors.RESET}")
                time.sleep(2)
                continue
            
            url = validate_url(url)
            
            # Request count
            num_input = input(f"{Colors.YELLOW}ğŸ”¢ Jumlah request (Enter = 1000){Colors.RESET}: ").strip()
            num_requests = int(num_input) if num_input else 1000
            
            # Workers
            workers_input = input(f"{Colors.YELLOW}ğŸ§µ Jumlah workers (Enter = 100){Colors.RESET}: ").strip()
            workers = int(workers_input) if workers_input else 100
            
            # Confirm
            print(f"\n{Colors.YELLOW}âš¡ KONFIGURASI STRESS TEST:{Colors.RESET}")
            print(f"   Target   : {Colors.WHITE}{url}{Colors.RESET}")
            print(f"   Requests : {Colors.WHITE}{num_requests}{Colors.RESET}")
            print(f"   Workers  : {Colors.WHITE}{workers}{Colors.RESET}")
            
            konfirmasi = input(f"\n{Colors.RED}{Colors.BOLD}âš ï¸  Lanjutkan stress test? (yes/no){Colors.RESET}: ").strip().lower()
            
            if konfirmasi not in ['yes', 'y']:
                print(f"{Colors.YELLOW}Test dibatalkan!{Colors.RESET}")
                time.sleep(1)
                continue
            
            # Run stress test
            results = stress_testing_advanced(url, num_requests, workers)
            
            # Display results
            display_stress_test_report(url, results)
            
            input(f"{Colors.YELLOW}Tekan Enter untuk kembali ke menu...{Colors.RESET}")
        
        elif pilihan == "3":
            print(f"\n{Colors.CYAN}{'â•' * 74}{Colors.RESET}")
            print(f"{Colors.YELLOW}ğŸ‘‹ Terima kasih telah menggunakan Web Security Scanner!{Colors.RESET}")
            print(f"{Colors.CYAN}{'â•' * 74}{Colors.RESET}\n")
            break
        
        else:
            print(f"\n{Colors.RED}âŒ Pilihan tidak valid!{Colors.RESET}")
            time.sleep(1)

if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        print(f"\n\n{Colors.RED}â›” Program dihentikan!{Colors.RESET}\n")
    except Exception as e:
        print(f"\n{Colors.RED}âŒ Fatal Error: {e}{Colors.RESET}\n")
